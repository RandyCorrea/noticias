<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstaNews</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-50 dark:bg-black">
    <div class="min-h-screen flex justify-center">
        <div class="w-full max-w-md bg-white dark:bg-black shadow-sm border-x border-gray-200 dark:border-gray-800">
            <header class="sticky top-0 z-50 bg-white dark:bg-black border-b border-gray-200 dark:border-gray-800 px-4 h-14 flex items-center justify-between">
                <a href="index.html" class="text-xl font-bold italic">InstaNews</a>
            </header>
            <main id="feed" class="pb-16"></main>
            <nav class="fixed bottom-0 w-full max-w-md bg-white dark:bg-black border-t border-gray-200 dark:border-gray-800 h-12 flex justify-around z-50">
                <a href="index.html" class="flex items-center justify-center p-2"><i data-lucide="home" class="w-6 h-6"></i></a>
                <button onclick="showProfile()" class="flex items-center justify-center p-2"><i data-lucide="user" class="w-6 h-6"></i></button>
            </nav>
        </div>
    </div>

    <script>
        const REPO = 'RandyCorrea/noticias';
        let newsData = [];
        let likedNews = JSON.parse(localStorage.getItem('likedNews') || '[]');

        async function loadNews() {
            try {
                const resp = await fetch(`https://api.github.com/repos/${REPO}/contents/news-data.json`);
                const data = await resp.json();
                newsData = JSON.parse(atob(data.content)).news || [];
                renderFeed();
                lucide.createIcons();
            } catch (e) { console.error(e); }
        }

        function renderFeed() {
            document.getElementById('feed').innerHTML = newsData.map(post => `
                <article class="border-b border-gray-200 dark:border-gray-800">
                    <div class="px-4 py-3 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-blue-500"></div>
                            <div><p class="font-semibold text-sm">${post.author || 'Noticias'}</p></div>
                        </div>
                        <button><i data-lucide="more-horizontal" class="w-4 h-4"></i></button>
                    </div>
                    ${post.videoEmbed ? `<div style="width:100%;aspect-ratio:1/1;background:#000">${post.videoEmbed}</div>` : post.image ? `<img src="${post.image}" class="w-full" style="aspect-ratio:1/1;object-fit:cover">` : ''}
                    <div class="px-4 py-3 flex gap-4">
                        <button onclick="toggleLike('${post.id}')"><i data-lucide="heart" class="w-6 h-6 ${likedNews.includes(post.id) ? 'fill-red-500 text-red-500' : ''}"></i></button>
                        <button><i data-lucide="message-circle" class="w-6 h-6"></i></button>
                        <button><i data-lucide="send" class="w-6 h-6"></i></button>
                        <button class="ml-auto"><i data-lucide="bookmark" class="w-6 h-6"></i></button>
                    </div>
                    <div class="px-4 pb-3">
                        <p class="font-bold text-sm">${post.title}</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${post.excerpt}</p>
                        <button onclick="window.location.href='posts/${post.slug}.html'" class="text-xs font-bold text-blue-500 mt-2">LEER M√ÅS</button>
                    </div>
                </article>
            `).join('');
            lucide.createIcons();
        }

        function toggleLike(id) {
            if (likedNews.includes(id)) likedNews = likedNews.filter(x => x !== id);
            else likedNews.push(id);
            localStorage.setItem('likedNews', JSON.stringify(likedNews));
            renderFeed();
        }

        function showProfile() { alert('Perfil: ' + likedNews.length + ' favoritos'); }

        loadNews();
    </script>
</body>
</html>
